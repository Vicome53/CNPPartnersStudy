---
title: "CNP Partners: Pago por tarjeta"
author: "Victorien Melot"
date: "24/05/2019"
output: rmdformats::material
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message= FALSE)
```


```{r echo=FALSE}
#Ancien code !! 
#library(epuRate)
library(markdown)
library(ggplot2)
library(dplyr)
library(readr)
library(plotly)
library(devtools)
library(rmdformats)
# La fonction qui permet de calculer le prix
fun1 = function(prix, nbrmax){
  
  # CAIXA 
   
  x1=c(0,5,10,20,30,40,50,60,70,80,90,100)
  x2=c()
  y1=c(0,0,0,0,0,0,0,0,0,0,0,0)
  tasaCaiXa= 0.003
  minimoCaixa=0.06
  tr1Caixa=600
  tr1CaixaPrix=19
  tr2CaixaPrix=9
  trQuanti=  tr1Caixa%/%prix
  if( is.element(trQuanti,x1)==FALSE){
    x2=c(x1,trQuanti,trQuanti)
    y1=c(y1,0,0)
  }
  else{ 
    x2=c(x1,trQuanti)
    y1=c(y1,0)
  }
  x3 =sort(x2)
  for ( i in 1:length(x2)){
    if (x3[i]<=trQuanti){
      if (prix*tasaCaiXa<minimoCaixa){
        y1[i]=x3[i]*minimoCaixa*prix+tr1CaixaPrix
      }
      else {
        y1[i]=x3[i]*tasaCaiXa*prix+tr1CaixaPrix
        }
    }
    else{
      if (prix*tasaCaiXa<minimoCaixa){
        y1[i]=x3[i]*minimoCaixa*prix+tr2CaixaPrix
      }
    
      else {y1[i]=x3[i]*tasaCaiXa*prix+tr2CaixaPrix}
    }
  }
  for ( i in 1:(length(x3)-1)){
    if(x3[i]==x3[i+1]){
      y1[i+1]=x3[i+1]*tasaCaiXa*prix+tr2CaixaPrix
    }
  }
  # premier plot
  p<-plot_ly(y=y1, x=x3,type="scatter", mode="markers+lines", name="Caixa")
  
  
  #CAJA RURAL
  xR1=c(0,5,10,20,30,40,50,60,70,80,90,100)
  xR2=c()
  yR=c(0,0,0,0,0,0,0,0,0,0,0,0)
  tasaRural= 0.0032
  minimoRural=0.35
  tr1Rural=1500
  tr1RuralPrix=15
  tr2RuralPrix=0
  trQuantiR=  tr1Rural%/%prix
  if( is.element(trQuantiR,xR1)==FALSE){
    xR2=c(xR1,trQuantiR,trQuantiR)
    yR=c(yR,0,0)
  }
  else{ 
    xR2=c(xR1,trQuantiR)
    yR=c(yR,0)
  }
  print("pas trié xR2")
  print(xR2)
  print("trie xR2")
  xR3 =sort(xR2)
  print(xR3)

  for ( i in 1:length(xR2)){
    if (xR3[i]<=trQuantiR){
      if (prix*tasaRural<minimoRural){
        yR[i]=xR3[i]*minimoRural+tr1RuralPrix
      }
      else {
        yR[i]=xR3[i]*tasaRural*prix+tr1RuralPrix
        }
    }
    else{
      if (prix*tasaRural<minimoRural){
        yR[i]=xR3[i]*minimoRural+tr2RuralPrix
      }
      else {yR[i]=xR3[i]*tasaRural*prix+tr2RuralPrix}
    }
  }
  for ( i in 1:(length(xR3)-1)){
    if(xR3[i]==xR3[i+1]){
      if (prix*tasaRural<minimoRural){
        yR[i+1]=xR3[i+1]*minimoRural+tr2RuralPrix
      }
      else {yR[i+1]=xR3[i+1]*tasaRural*prix+tr2RuralPrix}
    }
    }
  p<-add_trace(p, y=yR, x=xR3 , type="scatter", mode="markers+lines", name="Caja Rural" )
  
  
  #BBVA
  xBB1=c(0,5,10,20,30,40,50,60,70,80,90,100)
  yBB=c(0,0,0,0,0,0,0,0,0,0,0,0)
  tasaBBVA= 0.013
  tr1BBVA=0
  tr1BBVAPrix=0
  for ( i in 1:length(xBB1)){
    yBB[i]=xBB1[i]*tasaBBVA*prix+tr1BBVAPrix
  }
   p<-add_trace(p, y=yBB, x=xBB1 , type="scatter", mode="markers+lines", name="BBVA" )
  
  p
  }

```

# Estudio de los gastos para la implementacion de un TPV Virtual

Este documento presenta el estudio sobre los gastos provocados por la implementacion de un TPV Virtual.

En primer parte, podemos ver el precio de los gastos por transacciones en funcion del precio del producto que vendemos. Entonces hemos efectuado un estimacion del volumen de negocios con sus gastos.

Entonces, la ultima parte presenta los diferentes gastos de aplicacion segu los bancos.

Por fin, nuestro consejo respeto a la parte econimica. 









# Evolucion de los gastos segun el precio de nuestros productos

Para utilizar los TPV Virtual de los bancos y hacer transacion, los bancos aplican gastos por transaciones que son porcentaje de la suma de la transacion ( y con un minimo algunas veces) y hay gastos mensuales fijos para ciertos bancos.

Siguientes graficos presenten las evoluciones de lo gastos en foncion del numero de transaciones mensuales y el precio del producto.

```{r echo=FALSE}
# importation des librairies
library(plotly)
library(hrbrthemes)
# La fonction qui permet de calculer le prix
fun1 = function(prix){
  
  # CAIXA 
   
  x1=c(0,5,10,20,30,40,50,60,70,80,90,100)
  x2=c()
  y1=c(0,0,0,0,0,0,0,0,0,0,0,0)
  tasaCaiXa= 0.003
  minimoCaixa=0.06
  tr1Caixa=600
  tr1CaixaPrix=19
  tr2CaixaPrix=9
  trQuanti=  tr1Caixa%/%prix
  if( is.element(trQuanti,x1)==FALSE){
    x2=c(x1,trQuanti,trQuanti)
    y1=c(y1,0,0)
  }
  else{ 
    x2=c(x1,trQuanti)
    y1=c(y1,0)
  }
  x3 =sort(x2)
  for ( i in 1:length(x2)){
    if (x3[i]<=trQuanti){
      if (prix*tasaCaiXa<minimoCaixa){
        y1[i]=x3[i]*minimoCaixa*prix+tr1CaixaPrix
      }
      else {
        y1[i]=x3[i]*tasaCaiXa*prix+tr1CaixaPrix
        }
    }
    else{
      if (prix*tasaCaiXa<minimoCaixa){
        y1[i]=x3[i]*minimoCaixa*prix+tr2CaixaPrix
      }
    
      else {y1[i]=x3[i]*tasaCaiXa*prix+tr2CaixaPrix}
    }
  }
  for ( i in 1:(length(x3)-1)){
    if(x3[i]==x3[i+1]){
      y1[i+1]=x3[i+1]*tasaCaiXa*prix+tr2CaixaPrix
    }
  }
  
  
  
  #CAJA RURAL
  xR1=c(0,5,10,20,30,40,50,60,70,80,90,100)
  xR2=c()
  yR=c(0,0,0,0,0,0,0,0,0,0,0,0)
  tasaRural= 0.0032
  minimoRural=0.35
  tr1Rural=1500
  tr1RuralPrix=15
  tr2RuralPrix=0
  trQuantiR=  tr1Rural%/%prix
  if( is.element(trQuantiR,xR1)==FALSE){
    xR2=c(xR1,trQuantiR,trQuantiR)
    yR=c(yR,0,0)
  }
  else{ 
    xR2=c(xR1,trQuantiR)
    yR=c(yR,0)
  }
  
  xR3 =sort(xR2)
  
  for ( i in 1:length(xR2)){
    if (xR3[i]<=trQuantiR){
      if (prix*tasaRural<minimoRural){
        yR[i]=xR3[i]*minimoRural+tr1RuralPrix
      }
      else {
        yR[i]=xR3[i]*tasaRural*prix+tr1RuralPrix
        }
    }
    else{
      if (prix*tasaRural<minimoRural){
        yR[i]=xR3[i]*minimoRural+tr2RuralPrix
      }
      else {yR[i]=xR3[i]*tasaRural*prix+tr2RuralPrix}
    }
  }
  for ( i in 1:(length(xR3)-1)){
    if(xR3[i]==xR3[i+1]){
      if (prix*tasaRural<minimoRural){
        yR[i+1]=xR3[i+1]*minimoRural+tr2RuralPrix
      }
      else {yR[i+1]=xR3[i+1]*tasaRural*prix+tr2RuralPrix}
    }
    }

  
  
  #BBVA
  xBB1=c(0,5,10,20,30,40,50,60,70,80,90,100)
  yBB=c(0,0,0,0,0,0,0,0,0,0,0,0)
  tasaBBVA= 0.013
  tr1BBVA=0
  tr1BBVAPrix=0
  for ( i in 1:length(xBB1)){
    yBB[i]=xBB1[i]*tasaBBVA*prix+tr1BBVAPrix
  }

  # Permet de faire la 3 eme variable avec les noms des banques
  zBB=c()
  zc=c()
  zR=c()
  for ( i in 1:length(x2)){zc=c(zc,"Caixa")}
  for ( i in 1:length(xBB1)){zBB=c(zBB,"BBVA")}
  for ( i in 1:length(xR2)){zR=c(zR,"Caja Rural")}
   
# création de la data.frame
  dataCaixa <- data.frame("Numero"=c(x3,xR3,xBB1),"Gastos"=c(y1,yR,yBB), "Banco"=c(zc,zR,zBB))
  
  p <- dataCaixa %>%
    ggplot(aes(x=Numero, y=Gastos, color=Banco))+
    scale_color_brewer(palette = "Set2")+
    geom_line()+
    geom_point(alpha=0.7, shape=21)+
    theme_light()+
      ggtitle(paste(paste("Gastos para un precio de ",prix),"€"))+
    theme(
      plot.title = element_text(size=13, color="#03224c"),
      axis.ticks.y=element_blank(),
      axis.title=element_text(colour="#03224c",size=15, face="italic", family="serif"),
      axis.text.y=element_text(colour="#03224c", family="serif")
      
  ) +
    xlab("Numero de transacciones efectuados")+ # légende des axes
    ylab("Gastos totales")
  
  ggplotly(p)
  
  
  }
  

```

### Un precio de producto 20€
```{r echo=FALSE,fig.width=6,fig.height=4}
fun1(20)
```


### Un precio de producto 50€
```{r echo=FALSE,fig.width=6,fig.height=4}
fun1(50)
```


### Un precio de producto 100€
```{r echo=FALSE,fig.width=6,fig.height=4}
fun1(100)
```


### Un precio de producto 200€
```{r echo=FALSE,fig.width=6,fig.height=4}
fun1(200)
```

### Un precio de producto 1000€
```{r echo=FALSE,fig.width=6,fig.height=4}
fun1(1000 )
```

# Estimacion de los gastos con las estimaciones de venta

En un segun tiempo, hemos realizado estimaciones de venta segun los dos productos de riegos (TAR) que podrian venderse por tarjeta. Ademas, se anadira los productos de Youse que van a venderse mayoritariamente por tarjeta.

Consideremos que solamente los nuevos clientes van pagar con tarjeta. Asi, segun los meses despues de la aplicaion del pago con tarjeta, el importe total por tarjeta va a aumentar.

```{r echo=FALSE,fig.width=6,fig.height=4 }

library(readr)
library(ggplot2)
library(dplyr)
library(plotly)
fun2 = function(banco, gastos, mes, ChAff){
    
  Banco1=banco
  Gastos1=gastos
  data2 <- data.frame("Banco"=Banco1,"Gastos"=Gastos1)
  
  p2<-data2 %>%
    arrange(as.numeric(Gastos))%>% # trier nos article par valeur
    mutate(Banco=factor(Banco, Banco))%>% # trier nos article par valeur
    ggplot(aes(x=Banco, y=as.numeric(Gastos))) +
      geom_segment(aes(x=Banco, xend=Banco, y=0, yend=as.numeric(Gastos)), color="#03224c")+
      geom_point( color="#f4aa42",size=2, alpha=0.6)+
      theme_light()+
      ggtitle(paste(paste("Estimacion de los gastos para el",mes),"mes"))+
      coord_flip()+
      
      theme(
            axis.title=element_text(colour="#03224c",size=15, face="italic", family="serif"),
            axis.text.y=element_text(colour="#03224c",size=15, family="serif")
            
        ) +
      xlab("Nombre del banco")+ # légende des axes
      ylab(paste("Gastos implicados por",ChAff,"€"))+
    annotate("text", x = data2$Banco[which(data2$Banco=="BBVA")], y = data2$Gastos[which(data2$Banco=="BBVA")]+10, label =paste(data2$Gastos[which(data2$Banco=="BBVA")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )+
    annotate("text", x = data2$Banco[which(data2$Banco=="Caixa")], y = data2$Gastos[which(data2$Banco=="Caixa")]+10, label =paste(data2$Gastos[which(data2$Banco=="Caixa")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )+
    annotate("text", x = data2$Banco[which(data2$Banco=="CecaBank")], y = data2$Gastos[which(data2$Banco=="CecaBank")]+10, label =paste(data2$Gastos[which(data2$Banco=="CecaBank")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )+
    annotate("text", x = data2$Banco[which(data2$Banco=="Santander")], y = data2$Gastos[which(data2$Banco=="Santander")]+10, label =paste(data2$Gastos[which(data2$Banco=="Santander")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )+
    annotate("text", x = data2$Banco[which(data2$Banco=="CajaRural")], y = data2$Gastos[which(data2$Banco=="CajaRural")]+10, label =paste(data2$Gastos[which(data2$Banco=="CajaRural")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )
    
  ggplotly(p2)
    
}
```


```{r echo=FALSE,fig.width=6,fig.height=4}
# fonction de calcules des frais

funC= function(An1,Se1,Tr1,M1,An2,Se2,Tr2,M2,mes){
  PrixB=c()
  ListBancos=c("CajaRural","BBVA","Caixa","CecaBank","Santander")
  Pr1An=317.6
  Pr1Se=159.8
  Pr1Tr=70.97
  Pr1M=0
  Pr2An=276.4
  Pr2Se=137.4
  Pr2Tr=137.0
  Pr2M=110.3
  
  ListNbr=c(An1,Se1,Tr1,M1,An2,Se2,Tr2,M2)
  ListPrix=c(Pr1An,Pr1Se,Pr1Tr,Pr1M,Pr2An,Pr2Se,Pr2Tr,Pr2M)
  
  
  TasaRural=0.002
  MiniRural=0.35
  
  TasaCaixa=0.003
  MiniCaixa=0.06
  MensualGCaixa=9
  
  TasaBBVA=0.013
  
  
  
  GastosRural=0
  GastosBBVA=0
  GastosCaixa=0
  GastosCecaBank=0
  GastosSantander=0
  
  # CajaRural
  for ( i in 1:8){
      if (ListPrix[i]*TasaRural<MiniRural){
        GastosRural=GastosRural+ListNbr[i]*MiniRural
      }
      else {
         GastosRural=GastosRural+ListNbr[i]*TasaRural*ListPrix[i]
        }
  }
  
  #Caixa
  for ( i in 1:8){
      if (ListPrix[i]*TasaCaixa<MiniCaixa){
        GastosCaixa=GastosCaixa+ListNbr[i]*MiniCaixa
      }
      else {
         GastosCaixa=GastosCaixa+ListNbr[i]*TasaCaixa*ListPrix[i]
        }
  }
  GastosCaixa=GastosCaixa+MensualGCaixa
  
  #BBVA
   for ( i in 1:8){
     GastosBBVA=GastosBBVA+ListNbr[i]*TasaBBVA*ListPrix[i]
        
   }
  
  ChAff=0
  for (i in 1:8){
    ChAff=ChAff+ListNbr[i]*ListPrix[i]
  }
  
  fun2(c("BBVA","Caixa","CecaBank","Santander","CajaRural"), c(GastosBBVA,GastosCaixa,GastosCecaBank,GastosSantander,GastosRural), mes, ChAff)
  
  
  
}

 
 
 
 
 
 
``` 


### Para el Primer mes.

Cosideramos:
- 15 contratos de Mediadores

- 10 contratos de PayementsGlobal

```{r echo=FALSE,fig.width=6,fig.height=4}

funC(5,3,1,0,3,1,1,1,"primer")


```

### Estimacion por el sexto mes despues de la aplicacion.

Cosideramos:
* 15 contratos de Mediadores
* 10 contratos de PayementsGlobal

```{r echo=FALSE,fig.width=6,fig.height=4}

funC(11,9,7,0,6,3,4,5,"segundo")


```

### Estimacion por un ano despues de la aplicacion.

Cosideramos:
* 15 contratos de Mediadores
* 10 contratos de PayementsGlobal

***

```{r echo=FALSE,fig.width=6,fig.height=4}

funC(11,9,7,0,6,3,4,5,"segundo")


```


wesh |   wesh 2 |  eodne
-----|----------|---------
erre |    errrr | effrrr


# Los gastos de aplicacion


Sobre los gastos de aplicacion, son muy baja y permite de probar diferentes soluciones antes de elegir lo mejor

```{r}
library(readr)
library(ggplot2)
library(dplyr)
library(plotly)
    
Banco1=c("BBVA","Caixa","CecaBank","Santander","CajaRural")
Gastos1=c(100,40,300,56,76)
data3 <- data.frame("Banco"=Banco1,"Gastos"=Gastos1)

p3<-data3 %>%
  arrange(as.numeric(Gastos))%>% # trier nos article par valeur
  mutate(Banco=factor(Banco, Banco))%>% # trier nos article par valeur
  ggplot(aes(x=Banco, y=as.numeric(Gastos))) +
    geom_segment(aes(x=Banco, xend=Banco, y=0, yend=as.numeric(Gastos)), color="#03224c")+
    geom_point( color="#f4aa42",size=2, alpha=0.6)+
    theme_light()+
    coord_flip()+
  ggtitle("Gastos de aplicacion")+
  theme(
    axis.title=element_blank(),
    title=element_text(family="serif",colour="#03224c",size=15),
    axis.text.y=element_text(colour="#03224c",size=15, family="serif")
            
  )+
    annotate("text", x = data3$Banco[which(data3$Banco=="BBVA")], y = data3$Gastos[which(data3$Banco=="BBVA")]+10, label =paste(data3$Gastos[which(data3$Banco=="BBVA")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )+
    annotate("text", x = data3$Banco[which(data3$Banco=="Caixa")], y = data3$Gastos[which(data3$Banco=="Caixa")]+10, label =paste(data3$Gastos[which(data3$Banco=="Caixa")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )+
    annotate("text", x = data3$Banco[which(data3$Banco=="CecaBank")], y = data3$Gastos[which(data3$Banco=="CecaBank")]+10, label =paste(data3$Gastos[which(data3$Banco=="CecaBank")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )+
    annotate("text", x = data3$Banco[which(data3$Banco=="Santander")], y = data3$Gastos[which(data3$Banco=="Santander")]+10, label =paste(data3$Gastos[which(data3$Banco=="Santander")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )+
    annotate("text", x = data3$Banco[which(data3$Banco=="CajaRural")], y = data3$Gastos[which(data3$Banco=="CajaRural")]+10, label =paste(data3$Gastos[which(data3$Banco=="CajaRural")] %>% round(2),"€"),color="orange", size=4 , angle=0, fontface="bold", hjust=0 )

ggplotly(p3)

```

# Conclusion

Si tomamos un estimacion para 1 ano despues de la aplicacion, aqui la comparacion de los diferentes precios.
![" wesh alors"](image/capt1.PNG)


    